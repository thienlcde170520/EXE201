@{
    ViewData["Title"] = "Kết quả bài Test DASS-21";
}

<link rel="stylesheet" href="~/css/test.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<div class="main-container">
    <div class="result-container">
        <div class="result-header">
            <h1>Kết quả test Lo âu - Trầm cảm - Stress (DASS 21)</h1>
            <p class="result-description">
                Dưới đây là kết quả đánh giá mức độ lo âu, trầm cảm và stress của bạn theo thang đo DASS-21.
            </p>
        </div>

        @{
            // Calculate percentages based on scores
            int depressionScore = ViewData["DepressionScore"] != null ? Convert.ToInt32(ViewData["DepressionScore"]) : 0;
            int anxietyScore = ViewData["AnxietyScore"] != null ? Convert.ToInt32(ViewData["AnxietyScore"]) : 0;
            int stressScore = ViewData["StressScore"] != null ? Convert.ToInt32(ViewData["StressScore"]) : 0;

            string depressionLevel = ViewData["DepressionLevel"]?.ToString() ?? "Bình thường";
            string anxietyLevel = ViewData["AnxietyLevel"]?.ToString() ?? "Bình thường";
            string stressLevel = ViewData["StressLevel"]?.ToString() ?? "Bình thường";

            // Maximum possible scores (for DASS-21 doubled)
            const int maxScore = 42;

            // Calculate percentages (rounded to nearest integer)
            int depressionPercent = (int)Math.Round((double)depressionScore / maxScore * 100);
            int anxietyPercent = (int)Math.Round((double)anxietyScore / maxScore * 100);
            int stressPercent = (int)Math.Round((double)stressScore / maxScore * 100);

            // Determine color based on level
            string GetLevelColor(string level)
            {
                return level switch
                {
                    "Bình thường" => "#4caf50", // Green
                    "Nhẹ" => "#8bc34a",         // Light Green
                    "Vừa" => "#ffeb3b",         // Yellow
                    "Nặng" => "#ff9800",        // Orange
                    "Rất nặng" => "#f44336",    // Red
                    _ => "#4caf50"
                };
            }

            // Get result text based on percentage
            string GetResultText(int percentage, string type)
            {
                if (percentage < 33)
                {
                    return $"Bạn không có dấu hiệu của rối loạn {type} (bình thường).";
                }
                else if (percentage < 60)
                {
                    return $"Bạn đang trải qua rối loạn {type} ở mức độ trung bình.";
                }
                else if (percentage < 80)
                {
                    return $"Bạn đang trải qua rối loạn {type} ở mức độ nặng.";
                }
                else
                {
                    return $"Bạn đang trải qua rối loạn {type} ở mức độ rất nặng.";
                }
            }

            // Get gauge rotation angle (120 degrees total range from -60 to +60)
            int GetGaugeRotation(int percentage)
            {
                return -60 + (int)(percentage * 1.2);
            }

            string depressionColor = GetLevelColor(depressionLevel);
            string anxietyColor = GetLevelColor(anxietyLevel);
            string stressColor = GetLevelColor(stressLevel);

            string depressionText = GetResultText(depressionPercent, "Trầm cảm");
            string anxietyText = GetResultText(anxietyPercent, "Lo Âu");
            string stressText = GetResultText(stressPercent, "Stress");
        }

        <div class="gauge-container">
            <div class="gauge-row">
                <div class="gauge-item">
                    <div class="gauge">
                        <div class="gauge-labels">
                            <span class="label-min">0</span>
                            <span class="label-mild">24</span>
                            <span class="label-moderate">36</span>
                            <span class="label-severe">48</span>
                            <span class="label-max">100</span>
                        </div>
                        <div class="gauge-body">
                            <div class="gauge-fill" style="background: linear-gradient(90deg, #4caf50, #8bc34a, #ffeb3b, #ff9800, #f44336);">
                                <div class="gauge-cover"></div>
                            </div>
                            <div class="gauge-needle" style="transform: rotate(@(GetGaugeRotation(anxietyPercent))deg);"></div>
                        </div>
                        <div class="gauge-value">
                            <div class="gauge-title">Lo âu</div>
                            <div class="percentage-badge" style="background-color: @anxietyColor;">@anxietyPercent%</div>
                        </div>
                    </div>
                </div>

                <div class="gauge-item">
                    <div class="gauge">
                        <div class="gauge-labels">
                            <span class="label-min">0</span>
                            <span class="label-mild">24</span>
                            <span class="label-moderate">36</span>
                            <span class="label-severe">50</span>
                            <span class="label-max">100</span>
                        </div>
                        <div class="gauge-body">
                            <div class="gauge-fill" style="background: linear-gradient(90deg, #4caf50, #8bc34a, #ffeb3b, #ff9800, #f44336);">
                                <div class="gauge-cover"></div>
                            </div>
                            <div class="gauge-needle" style="transform: rotate(@(GetGaugeRotation(depressionPercent))deg);"></div>
                        </div>
                        <div class="gauge-value">
                            <div class="gauge-title">Trầm cảm</div>
                            <div class="percentage-badge" style="background-color: @depressionColor;">@depressionPercent%</div>
                        </div>
                    </div>
                </div>

                <div class="gauge-item">
                    <div class="gauge">
                        <div class="gauge-labels">
                            <span class="label-min">0</span>
                            <span class="label-mild">36</span>
                            <span class="label-moderate">45</span>
                            <span class="label-severe">62</span>
                            <span class="label-max">100</span>
                        </div>
                        <div class="gauge-body">
                            <div class="gauge-fill" style="background: linear-gradient(90deg, #4caf50, #8bc34a, #ffeb3b, #ff9800, #f44336);">
                                <div class="gauge-cover"></div>
                            </div>
                            <div class="gauge-needle" style="transform: rotate(@(GetGaugeRotation(stressPercent))deg);"></div>
                        </div>
                        <div class="gauge-value">
                            <div class="gauge-title">Stress</div>
                            <div class="percentage-badge" style="background-color: @stressColor;">@stressPercent%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="result-conclusion">
            <h2>Kết luận:</h2>
            <div class="conclusion-content">
                <p><strong>Lo âu:</strong> @anxietyText</p>
                <p><strong>Trầm cảm:</strong> @depressionText</p>
                <p><strong>Stress:</strong> @stressText</p>
            </div>
        </div>

        @{
            // Determine overall advice based on severity
            bool hasSevereCondition = depressionPercent >= 60 || anxietyPercent >= 60 || stressPercent >= 60;
            bool hasModerateCondition = depressionPercent >= 33 || anxietyPercent >= 33 || stressPercent >= 33;
        }

        <div class="result-recommendations">
            <h2>Lời khuyên của chuyên gia</h2>

            <div class="expert-advice">
                <p>Gửi đến bạn cái ôm đầy sự chia sẻ và thấu hiểu.</p>
                <p>Là một chuyên gia tâm lý, tôi thấu hiểu những khó khăn và áp lực mà mỗi người đang phải đối mặt trong cuộc sống. Cuộc sống hiện đại với nhịp sống hối hả, nhiều lo toan có thể khiến chúng ta dễ dàng rơi vào trạng thái lo âu, căng thẳng hay stress, ảnh hưởng đến sức khỏe tinh thần và thể chất. Điều quan trọng là chúng ta cần nhận thức được vấn đề và tìm kiếm giải pháp để cải thiện.</p>

                @if (hasSevereCondition)
                {
                    <div class="advice-section">
                        <h3>Các khuyến nghị chính:</h3>
                        <ul>
                            <li><strong>Tìm kiếm hỗ trợ chuyên nghiệp ngay lập tức:</strong> Hãy tìm đến sự trợ giúp của chuyên gia tâm lý. Các chuyên gia sẽ hỗ trợ bạn tìm hiểu nguyên nhân gốc rễ của vấn đề và đưa ra phương pháp điều trị phù hợp.</li>
                            <li><strong>Không cô lập bản thân:</strong> Đừng ngần ngại tìm kiếm sự giúp đỡ từ gia đình và bạn bè. Họ luôn sẵn lòng lắng nghe và hỗ trợ bạn.</li>
                            <li><strong>Thiết lập thói quen hàng ngày khoa học:</strong> Ăn uống và ngủ nghỉ đúng giờ, tập thể dục đều đặn.</li>
                            <li><strong>Tìm kiếm nhóm hỗ trợ:</strong> Bạn có thể tham gia các nhóm có cùng tình trạng để chia sẻ và học hỏi kinh nghiệm từ người khác.</li>
                        </ul>
                    </div>
                }
                else if (hasModerateCondition)
                {
                    <div class="advice-section">
                        <h3>Các khuyến nghị chính:</h3>
                        <ul>
                            <li><strong>Tập thể dục thường xuyên:</strong> Hoạt động thể chất giúp giải phóng endorphin - hormone hạnh phúc, đồng thời giúp giảm căng thẳng và cải thiện tâm trạng.</li>
                            <li><strong>Tâm sự với người thân:</strong> Đừng ngại chia sẻ cảm xúc của mình để nhận được sự hỗ trợ.</li>
                            <li><strong>Hạn chế sử dụng chất kích thích:</strong> Rượu bia, thuốc lá, caffeine có thể khiến tình trạng căng thẳng thêm tồi tệ.</li>
                            <li><strong>Thực hành các kỹ thuật thư giãn:</strong> Thiền, yoga, hoặc hít thở sâu để giảm căng thẳng.</li>
                        </ul>
                    </div>
                }
                else
                {
                    <div class="advice-section">
                        <h3>Các khuyến nghị duy trì:</h3>
                        <ul>
                            <li><strong>Duy trì một lối sống lành mạnh:</strong> Ăn uống đủ chất, ngủ đủ giấc, vận động thể dục thường xuyên.</li>
                            <li><strong>Thực hiện các hoạt động quản lý stress:</strong> Như thiền, yoga, hoặc hít thở sâu.</li>
                            <li><strong>Kết nối xã hội:</strong> Dành thời gian với gia đình và bạn bè.</li>
                            <li><strong>Thư giãn và giải trí:</strong> Tìm kiếm những hoạt động bạn yêu thích và dành thời gian cho bản thân.</li>
                        </ul>
                    </div>
                }

                <p>Hãy nhớ rằng, bạn không đơn độc! Rất nhiều người đang trải qua những điều tương tự như bạn, giữ vững niềm tin và không bỏ cuộc nhé!</p>
            </div>

            <div class="resource-cards">
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-headphones"></i>
                    </div>
                    <h3>Podcast thư giãn</h3>
                    <p>Nghe các bài podcast giúp thư giãn tâm trí và giảm stress</p>
                    <a href="/Podcast/Index" class="resource-btn">Nghe ngay</a>
                </div>

                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <h3>Tư vấn chuyên gia</h3>
                    <p>Đặt lịch tư vấn với các chuyên gia tâm lý</p>
                    <a href="/Doctor/Index" class="resource-btn">Đặt lịch</a>
                </div>

                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-book-reader"></i>
                    </div>
                    <h3>Tài liệu hữu ích</h3>
                    <p>Tìm hiểu thêm về sức khỏe tinh thần</p>
                    <a href="#" class="resource-btn">Khám phá</a>
                </div>
            </div>
        </div>

        <div class="result-actions">
            <a href="/Test/Index" class="result-back-btn">Quay lại trang chủ</a>
            <a href="/Test/DASS21" class="result-retry-btn">Làm lại bài kiểm tra</a>
        </div>
    </div>
</div>

<style>
    body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
    }

    .main-container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .result-container {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        padding: 40px;
        margin-bottom: 30px;
    }

    .result-header {
        text-align: center;
        margin-bottom: 40px;
    }

        .result-header h1 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: #333;
        }

    .result-description {
        font-size: 1.1rem;
        color: #555;
        max-width: 800px;
        margin: 0 auto;
    }

    /* Gauge styles */
    .gauge-container {
        margin: 30px 0;
    }

    .gauge-row {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px;
    }

    .gauge-item {
        flex: 1;
        min-width: 280px;
        padding: 20px;
    }

    .gauge {
        position: relative;
        width: 100%;
    }

    .gauge-labels {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 12px;
        color: #777;
    }

    .gauge-body {
        position: relative;
        height: 130px;
        overflow: hidden;
    }

    .gauge-fill {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 130px;
        border-radius: 150px 150px 0 0;
    }

    .gauge-cover {
        position: absolute;
        top: 20px;
        left: 10%;
        width: 80%;
        height: 160px;
        background: white;
        border-radius: 120px 120px 0 0;
    }

    .gauge-needle {
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 3px;
        height: 90px;
        background: #333;
        transform-origin: bottom center;
        transition: transform 1s ease-out;
        z-index: 10;
    }

    .gauge-value {
        text-align: center;
        margin-top: 10px;
    }

    .gauge-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .percentage-badge {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        color: white;
        font-weight: bold;
        font-size: 16px;
        margin-top: 5px;
    }

    /* Conclusion section */
    .result-conclusion {
        background-color: #f9f9f9;
        border-radius: 10px;
        padding: 25px;
        margin: 40px 0;
    }

        .result-conclusion h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
        }

    .conclusion-content {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

        .conclusion-content p {
            margin-bottom: 15px;
            font-size: 16px;
        }

            .conclusion-content p:last-child {
                margin-bottom: 0;
            }

    /* Expert advice section */
    .result-recommendations {
        margin-top: 50px;
    }

        .result-recommendations h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }

    .expert-advice {
        background-color: #f5f9ff;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        border-left: 4px solid #4e54c8;
    }

        .expert-advice p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

    .advice-section {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

        .advice-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #444;
        }

        .advice-section ul {
            padding-left: 20px;
        }

        .advice-section li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

    /* Resource cards */
    .resource-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 40px;
    }

    .resource-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        text-align: center;
        transition: transform 0.2s;
    }

        .resource-card:hover {
            transform: translateY(-5px);
        }

    .resource-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #f0f5ff;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
    }

        .resource-icon i {
            font-size: 1.8rem;
            color: #4e54c8;
        }

    .resource-card h3 {
        margin-bottom: 10px;
        color: #444;
    }

    .resource-card p {
        margin-bottom: 20px;
        color: #666;
    }

    .resource-btn {
        display: inline-block;
        background-color: #4e54c8;
        color: white;
        padding: 8px 20px;
        border-radius: 5px;
        text-decoration: none;
        transition: background-color 0.3s;
    }

        .resource-btn:hover {
            background-color: #3f45b6;
            color: white;
        }

    /* Action buttons */
    .result-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 50px;
    }

    .result-back-btn, .result-retry-btn {
        padding: 12px 25px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 500;
    }

    .result-back-btn {
        background-color: #e9ecef;
        color: #495057;
    }

    .result-retry-btn {
        background-color: #4e54c8;
        color: white;
    }

    .result-back-btn:hover {
        background-color: #dee2e6;
    }

    .result-retry-btn:hover {
        background-color: #3f45b6;
        color: white;
    }

    /* Responsive styles */
    @@media (max-width: 768px) {
        .result-container {
            padding: 20px;
        }

        .result-header h1 {
            font-size: 1.8rem;
        }

        .gauge-row {
            flex-direction: column;
        }

        .gauge-item {
            min-width: 100%;
        }

        .result-actions {
            flex-direction: column;
            gap: 15px;
        }

        .result-back-btn, .result-retry-btn {
            text-align: center;
        }
    }
</style> 